# プロダクト要求定義書

## 1. プロダクトビジョンと目的

### プロダクト定義

**「利息で買い物できるAIコンシェルジュ」**

JPYCをDeFiで運用し、得られた利息で楽天市場の商品を購入できる。運用の成果を「年利○%」ではなく「3ヶ月後にはこのチョコが買える」という形で実感でき、元本を減らさずに買い物を楽しめる新しい消費体験を提供する。

### なぜJPYCか

- JPYCハッカソンへの出展
- 2025年に日本で正式発行され、2026年はステーブルコイン元年としてトレンドになると予想
- 1 JPYC = 1円の日本円ペッグで、日本人ユーザーにとって価値が直感的に理解できる
- 国内規制に準拠した信頼性

### なぜ楽天市場か

- 日本人をターゲットにするため、国内で人気のECサイトを選定
- Amazonではなく「日本のサービス」という親しみやすさ
- 豊富な商品ラインナップで「利息で買えるもの」の選択肢が広い

### なぜAIエージェントか

- 仮想通貨を触ったことがない一般ユーザーにとって、ウォレット操作は難しい
- AIエージェントが対話形式でナビゲーションすることで、専門知識がなくても操作可能
- 「運用したい」「何か買える？」という自然な言葉でDeFi・決済が完結

### なぜx402か

- AIエージェントとステーブルコイン送金の相性が良い
- ガスコスト0で送金可能（DeFi Deposit以外の通常送金）
- JPYC対応Facilitatorが利用可能

### 目的

- 仮想通貨未経験者でもDeFi運用・ステーブルコイン決済ができることを示す
- 「運用 × 消費」の新しい体験を提案
- JPYCの実用性をデモンストレーション

## 2. ターゲットユーザーと課題・ニーズ

### プライマリペルソナ

**佐藤さん（29歳・大手メーカー勤務）**

| 項目         | 詳細                                                         |
| ------------ | ------------------------------------------------------------ |
| 年収         | 600万円                                                      |
| 居住地       | 東京都内（一人暮らし）                                       |
| 資産運用     | 積立NISAで毎月3万円を投資信託に                              |
| 仮想通貨経験 | 興味はあるが「難しそう」で手を出していない                   |
| 消費スタイル | 好きなものを好きなだけは買えない。貯めてからご褒美として購入 |
| ITリテラシー | スマホ・PCは日常的に使う。新しいアプリにも抵抗なし           |

**佐藤さんの課題**

- 積立NISA以外の資産運用手段を探している
- 仮想通貨は「難しい」「怖い」というイメージがある
- 運用の成果が実感しにくい（数字だけ見てもピンとこない）

**佐藤さんのニーズ**

- 難しい操作なしで新しい資産運用を始めたい
- 運用の成果を「何か買える」という形で実感したい
- 信頼できる日本円ペッグのステーブルコインを使いたい

### セカンダリペルソナ（管理者）

**運営チームメンバー**

- ユーザーの注文を確認し、代理購入を実行する
- 楽天市場で商品を注文し、ユーザーの住所に配送手配

### アンチペルソナ（このプロダクトが向かない人）

- 仮想通貨に精通していて自分でDeFi操作ができる人
- 日本円以外の通貨で運用したい人
- 即座に大きなリターンを求める人

### デモ対象者

| 対象者                     | 特徴                   | 伝えるべきこと               |
| -------------------------- | ---------------------- | ---------------------------- |
| JPYC創業者                 | JPYCの可能性を熟知     | 一般ユーザーへのリーチ可能性 |
| ソフトバンクWeb3事業責任者 | 事業視点で評価         | ビジネスモデルの実現可能性   |
| Ethereum Foundation        | 技術視点で評価         | UXの革新性                   |
| Avalanche Foundation       | エコシステム拡大に関心 | Avalancheでの展開可能性      |

**重要**: デモ対象者は仮想通貨に詳しいが、このアプリは初心者向け。「佐藤さんのような一般ユーザーに刺さる」ことを伝える必要がある。

## 3. 主要な機能一覧

### コア機能

| 機能カテゴリ   | 機能名                  | 概要                                                       |
| -------------- | ----------------------- | ---------------------------------------------------------- |
| 運用（増やす） | DeFi預け入れ（Deposit） | secured.financeにJPYCを預けて運用開始                      |
| 運用（増やす） | 運用状況確認            | 元本・利息・運用期間の確認                                 |
| 運用（増やす） | 利益の請求（Claim）     | 発生した利息を請求                                         |
| 運用（増やす） | 引き出し（Withdraw）    | 運用中のJPYCを引き出し                                     |
| 購入（使う）   | 商品検索                | 楽天市場から商品を検索・提案                               |
| 購入（使う）   | 利息ショッピング提案    | 運用利息の範囲内で買える商品を提案（将来買えるものも含む） |
| 購入（使う）   | 住所ヒアリング          | チャットで配送先住所を収集                                 |
| 購入（使う）   | x402決済                | JPYCで商品代金をガスレス送金                               |
| 管理           | 注文管理                | 管理者が注文一覧・ステータスを管理                         |

### 補助機能

| 機能名         | 概要                             |
| -------------- | -------------------------------- |
| ウォレット接続 | MetaMaskでウォレットを接続       |
| 残高表示       | ウォレット残高・運用中残高の表示 |

## 4. 成功の定義

### デモ成功基準（必須）

| 指標         | 目標                    | 測定方法                           |
| ------------ | ----------------------- | ---------------------------------- |
| 機能動作     | 全9機能がエラーなく動作 | 下記チェックリストをすべて満たす   |
| デモ所要時間 | 3分以内                 | デモフローを時間内に完走           |
| 致命的バグ   | 0件                     | デモ中にクラッシュ・フリーズしない |

**機能チェックリスト**

- [ ] secured.financeへのDeposit
- [ ] 運用状況（利益）の確認
- [ ] 資金のWithdraw
- [ ] 利益のClaim
- [ ] 楽天市場商品検索
- [ ] 運用益の範囲内で買える商品を提案（将来買えるものも含む）
- [ ] チャットで住所ヒアリング
- [ ] x402経由でJPYC送金
- [ ] 管理者ダッシュボードで注文管理

### デモフロー（3分）

```
1. secured.financeへのDeposit（運用開始）
2. 運用益内で買える商品の提案
   →「3ヶ月後にはこの商品がご褒美として買えるようになります」
3. 住所ヒアリング
4. 利益分のClaim
5. x402でJPYC送金
6. 管理者ダッシュボードから注文確認・代理注文
```

**備考**: 短期間で実際のDeFi利益を出すのは難しいため、「将来買える商品」という形で提案。購入フローは別途デモする可能性あり。

## 5. ビジネス要件

### 前提条件

- KYCは不要（ウォレット接続のみで利用可能）
- 楽天市場はJPYC決済未対応のため、代理購入方式を採用
- x402プロトコルとJPYC対応Facilitatorを使用
- ガスレス送金はx402利用時のみ（DeFi Depositは通常のトランザクション）

### 制約事項

- 商品の配送は管理者による代理購入に依存
- 運用はsecured.financeに限定
- ECサイトは楽天市場に限定
- チェーン: Avalanche（対応可能な場合）、無理ならSepolia

### ステークホルダー

| ステークホルダー | 役割                                   |
| ---------------- | -------------------------------------- |
| ユーザー         | JPYCの運用・購入を行う                 |
| 管理者           | 注文を確認し、代理購入を実行           |
| JPYC             | ステーブルコイン発行元、ハッカソン主催 |
| secured.finance  | DeFiプロトコル提供                     |
| 楽天市場         | 商品情報・購入先                       |

## 6. ユーザーストーリー

### US-001: JPYCを運用する

```
佐藤さん（積立NISA経験者）として、
チャットで「運用したい」と伝えることで、
JPYCをDeFiに預けて利息を得たい。
なぜなら、積立NISA以外の新しい資産運用手段を試したいから。
```

### US-002: 運用状況を確認する

```
佐藤さんとして、
チャットで「今いくら増えた？」と聞くことで、
現在の運用状況（元本・利息・期間）を知りたい。
なぜなら、運用の成果を数字で確認したいから。
```

### US-003: 利息で買えるものを知る

```
佐藤さんとして、
チャットで「利息で何か買える？」と聞くことで、
運用利息の範囲内で買える商品（または将来買える商品）を提案してほしい。
なぜなら、運用の成果を「買えるもの」として実感したいから。
```

### US-004: 商品を購入する

```
佐藤さんとして、
チャットで欲しい商品を伝え、住所を教えることで、
JPYCで商品を購入し、自宅に届けてほしい。
なぜなら、ステーブルコインで実際に買い物をしてみたいから。
```

### US-005: 注文を管理する（管理者）

```
運営チームとして、
ダッシュボードで注文一覧を確認し、ステータスを更新することで、
ユーザーの注文を適切に処理したい。
なぜなら、代理購入を確実に実行する必要があるから。
```

## 7. 受け入れ条件

### AC-001: DeFi預け入れ（Deposit）

- [ ] ユーザーがチャットで運用意思を伝えられる
- [ ] AIが金額をヒアリングできる
- [ ] ウォレットで承認後、secured.financeに預け入れできる
- [ ] 預け入れ完了のメッセージが表示される

### AC-002: 運用状況確認

- [ ] チャットで運用状況を質問できる
- [ ] 元本・利息・運用期間が表示される

### AC-003: 利益の請求（Claim）

- [ ] チャットで利益請求の意思を伝えられる
- [ ] ウォレットで承認後、利息がウォレットに入金される
- [ ] Claim完了のメッセージが表示される

### AC-004: 引き出し（Withdraw）

- [ ] チャットで引き出しの意思を伝えられる
- [ ] AIが金額をヒアリングできる
- [ ] ウォレットで承認後、JPYCがウォレットに戻る
- [ ] 引き出し完了のメッセージが表示される

### AC-005: 商品検索・提案

- [ ] チャットで欲しい商品を伝えられる
- [ ] 楽天市場から商品情報を取得できる
- [ ] 商品名・画像・価格・詳細が表示される
- [ ] 複数の候補が提案される

### AC-006: 利息ショッピング提案

- [ ] 現在の利息額（または将来の予測利息）が取得できる
- [ ] 利息の範囲内で買える商品が提案される
- [ ] 将来買える場合は「○ヶ月後に買えます」と表示される

### AC-007: 住所ヒアリング

- [ ] AIが配送先住所を自然に質問できる
- [ ] ユーザーが住所を入力できる
- [ ] 住所の確認ができる

### AC-008: x402決済

- [ ] 商品代金がx402プロトコルでガスレス送金できる
- [ ] 運営者ウォレットに着金する
- [ ] 送金完了のメッセージが表示される

### AC-009: 管理者ダッシュボード

- [ ] 注文一覧が表示される
- [ ] 各注文の詳細（商品・金額・住所・ステータス）が確認できる
- [ ] ステータスを更新できる（注文受付→発注済→発送済→完了）

## 8. 機能要件

### FR-001: ウォレット連携

- MetaMaskに接続できる
- 接続中のアドレスとJPYC残高を表示する
- 接続の切断ができる

### FR-002: チャットインターフェース

- ユーザーがテキストメッセージを送信できる
- AIエージェントが応答を返す
- 商品情報はカード形式で表示する（画像・名前・価格・詳細）
- 会話履歴が保持される

### FR-003: DeFi連携（secured.finance）

- チェーン: Avalanche（対応可能な場合）、無理ならSepolia
- JPYCの預け入れ（Deposit）トランザクションを生成する
- 引き出し（Withdraw）トランザクションを生成する
- 利益請求（Claim）トランザクションを生成する
- 運用状況（元本・利息）を取得する
- コントラクトアドレス・メソッド: 要調査

### FR-004: 楽天市場連携

- 楽天商品検索API（https://webservice.rakuten.co.jp/）を使用
- キーワードで商品を検索する
- 商品情報（名前・画像・価格・詳細・URL）を取得する
- 価格範囲でフィルタリングできる

### FR-005: x402決済

- JPYC対応Facilitatorを使用する
- ガスレスで指定金額を運営者ウォレットに送金する
- 送金のトランザクションハッシュを記録する
- 具体的な実装方法: 要調査

### FR-006: 注文管理

- 注文情報をデータベースに保存する
- 注文一覧を取得する
- 注文ステータスを更新する

## 9. 非機能要件

### NFR-001: パフォーマンス

- チャット応答は10秒以内
- 商品検索は15秒以内

### NFR-002: セキュリティ

- 秘密鍵はユーザーのウォレットで管理（アプリは保持しない）
- トランザクションはユーザー自身が承認
- 管理者ダッシュボードは認証必須

### NFR-003: 対応環境

- ブラウザ: Chrome最新版（必須）、Safari、Firefox（任意）
- デバイス: デスクトップ・モバイル両対応（レスポンシブ）
- ウォレット: MetaMaskのみ
- チェーン: Avalanche（優先）、Sepolia（フォールバック）

### NFR-004: 言語・地域

- 対応言語: 日本語のみ
- 利用地域: 日本

### NFR-005: データ保持

- 会話履歴: 30日間保持（実装優先度: 低）
- 注文履歴: 永続的に保持
- 個人情報（住所）: データベースに保存

### NFR-006: 同時接続

- デモ時: 10人程度の同時利用を想定
- 技術的に難しい場合は1人でも可（動画撮影用）

### NFR-007: 障害対応

- トランザクション失敗時: エラー内容をユーザーに通知し、再度署名操作を依頼
- API失敗時: エラーメッセージを表示
- エラー内容はコンソールに出力し、デバッグしやすくする

### NFR-008: ログ

- エラー発生時にすぐデバッグできるようエラー内容を出力
- ログ保持期間の設計は後回し

## 10. 未確定事項

| 項目                                                | 現状   | 確定方法                        |
| --------------------------------------------------- | ------ | ------------------------------- |
| secured.financeのAvalanche対応                      | 未確認 | 調査が必要                      |
| secured.financeのコントラクトアドレス               | 未確認 | 調査が必要                      |
| secured.financeのメソッド（Deposit/Withdraw/Claim） | 未確認 | 調査が必要                      |
| x402の具体的な実装方法                              | 未確認 | JPYC対応Facilitatorの仕様を調査 |
| 楽天APIのアプリケーションID                         | 未取得 | 開発者登録が必要                |
